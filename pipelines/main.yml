pr:
  - main
trigger:
  batch: "true"
  branches:
    include: 
      - main
  tags:
    include:
    - '*'
  paths:
    exclude: 
      - '_test-agent/*'
      - '.vscode/*'
      - '.devcontainer/*'
  
variables:
  tf_variables_secure_file: 4a0c36e2-bb51-41ed-87b1-2e668c64bb69
  marketplace_publisher: JasonBJohnson

pool:
  vmImage: ubuntu-latest

name: $(GitVersion.FullSemVer)

stages:
- stage: setup
  variables:
    - group: build
  jobs:
  - job: version
    steps:
    - task: gitversion/setup@0
      displayName: install GitVersion
      inputs:
        versionSpec: '5.x'
    - task: gitversion/execute@0
      displayName: set version
      name: version

  - job: tags
    steps:
    - script: scripts/max_tags.sh
      name: tags